{% extends 'base.html' %}
{% block content %}
  <div class="question-card">
    <div class="card-header">
      <h4 class="card-title mb-0">Q{{ q_id }}. {{ question.text }}</h4>
      {% if question.topic %}<div class="question-topic">{{ question.topic }}</div>{% endif %}
    </div>
    <div class="card-body">
      <div class="mt-3">
        {% if is_correct %}
          <div class="alert alert-success">
            <h5 class="alert-heading">Correct! ðŸŽ‰</h5>
            <p class="mb-0">Great job! You got it right.</p>
          </div>
        {% else %}
          <div class="alert alert-danger">
            <h5 class="alert-heading">Incorrect</h5>
            <p class="mb-0">The correct answer is <strong>{{ question.answer }}</strong>.</p>
          </div>
        {% endif %}
      </div>
      
      <div class="list-group mt-4">
        {% for key, val in question.options.items() %}
          <div class="list-group-item d-flex justify-content-between align-items-center {% if key == question.answer %}correct{% endif %} {% if selected == key and not is_correct %}incorrect{% endif %}">
            <span><strong>{{ key }}.</strong> {{ val }}</span>
            <div>
              {% if key == question.answer %}<span class="badge bg-success">âœ“ Answer</span>{% endif %}
              {% if selected == key and not is_correct %}<span class="badge bg-danger">âœ— Your choice</span>{% endif %}
            </div>
          </div>
        {% endfor %}
      </div>
      
      <div class="d-flex gap-3 mt-4">
        {% if q_id < total_questions %}
          <a href="{{ url_for('main.question', q_id=q_id + 1) }}" class="btn btn-primary">Next Question</a>
        {% else %}
          <a href="{{ url_for('main.index') }}" class="btn btn-primary">Back to Home</a>
        {% endif %}
        <a href="{{ url_for('main.index') }}" class="btn btn-outline-secondary">Back to Home</a>
      </div>
    </div>
  </div>
{% endblock %}

{% block scripts %}
<script>
  // Track when result is shown
  va('track', 'result_viewed', {
    question_id: '{{ q_id }}',
    is_correct: '{{ "true" if is_correct else "false" }}',
    selected_answer: '{{ selected }}',
    correct_answer: '{{ question.answer }}',
    topic: '{{ question.topic or "general" }}'
  });
  
  // Track navigation actions
  document.addEventListener('click', function(e) {
    if (e.target.tagName === 'A') {
      if (e.target.textContent.includes('Next Question')) {
        va('track', 'next_question_clicked', {
          current_question: '{{ q_id }}',
          total_questions: '{{ total_questions }}'
        });
      } else if (e.target.textContent.includes('Back to Home')) {
        va('track', 'back_to_home_clicked', {
          from_page: 'result',
          question_id: '{{ q_id }}'
        });
      }
    }
  });
</script>
{% endblock %}
